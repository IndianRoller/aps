/*
USE [master]
GO
CREATE LOGIN [apceps] WITH PASSWORD=N'apceps', DEFAULT_DATABASE=[apceps], CHECK_EXPIRATION=OFF, CHECK_POLICY=OFF
GO
ALTER SERVER ROLE [sysadmin] ADD MEMBER [apceps]
GO
*/

USE [master]
GO

IF(EXISTS (SELECT name from sys.databases where name='apceps')) 
BEGIN

 ALTER DATABASE [apceps] SET  SINGLE_USER WITH ROLLBACK IMMEDIATE
 DROP DATABASE apceps
 
END


USE [master]
GO

CREATE DATABASE [apceps] CONTAINMENT = NONE ON  PRIMARY  ( NAME = N'apceps', FILENAME = N'C:\VS\SQL_DATA\APCEPS\apceps.mdf' , SIZE = 3072KB , FILEGROWTH = 1024KB )
LOG ON ( NAME = N'apceps_log', FILENAME = N'C:\VS\SQL_DATA\APCEPS\apceps_log.ldf' , SIZE = 1024KB , FILEGROWTH = 10%)
GO
USE [apceps]
GO
IF NOT EXISTS (SELECT name FROM sys.filegroups WHERE is_default=1 AND name = N'PRIMARY') ALTER DATABASE [apceps] MODIFY FILEGROUP [PRIMARY] DEFAULT
GO


 


USE [apceps]
GO
CREATE USER [apceps] FOR LOGIN [apceps]
GO

 
/*
DROP TABLE AS_ORDER
DROP TABLE AS_PRODUCT
DROP TABLE AS_USER_LOCATION
DROP TABLE AS_LOCATION 
DROP TABLE AS_ROLE_MENU  
DROP TABLE AS_MENU 
DROP TABLE AS_USER 
DROP TABLE AS_ROLE   
DROP TABLE AS_SEQUENCES
Go
*/

USE [apceps]
GO


CREATE TABLE AS_SEQUENCES ( 
	SEQ_NAME VARCHAR(40),
    NEXT_VAL BIGINT,
    INCR_VAL BIGINT,
	CONSTRAINT PK_SEQUENCES PRIMARY KEY (SEQ_NAME) 
 )
 Go 


 CREATE TABLE AS_ROLE ( 
	ROLE_ID BIGINT, 
	ROLE_NAME VARCHAR(40),
	ROLE_DESC VARCHAR(100),
	CONSTRAINT PK_ROLE PRIMARY KEY (ROLE_ID) , 
 	CONSTRAINT UK_ROLE_ROLENAME UNIQUE (ROLE_NAME)
)
Go

CREATE TABLE AS_USER  ( 
	USER_ID BIGINT, 
	USER_NAME VARCHAR(40),
	USER_PASSWORD VARCHAR(40), 
	ROLE_ID BIGINT ,
	EMAIL VARCHAR(100),
	CONSTRAINT PK_USER PRIMARY KEY (USER_ID) , 
	CONSTRAINT FK_USER_ROLEID FOREIGN KEY (ROLE_ID) REFERENCES AS_ROLE(ROLE_ID),
	CONSTRAINT UK_USER_NAME UNIQUE (USER_NAME)
)
Go
 

CREATE TABLE AS_MENU  ( 
	MENU_ID BIGINT, 
	MENU_NAME VARCHAR(40),
	MENU_URL VARCHAR(100),
	CONSTRAINT PK_MENU PRIMARY KEY (MENU_ID) , 
 	CONSTRAINT UK_MENU_NAME UNIQUE (MENU_NAME)
)
Go

 CREATE TABLE AS_ROLE_MENU  ( 
	ROLEMENU_ID BIGINT, 
	ROLE_ID BIGINT,
	MENU_ID BIGINT,
	ADD_ALLOWED CHAR(1),
	MODIFY_ALLOWED CHAR(1),
	VIEW_ALLOWED CHAR(1),
	DELETE_ALLOWED CHAR(1),
	CONSTRAINT PK_ROLEMENU PRIMARY KEY (ROLEMENU_ID) , 
	CONSTRAINT FK_ROLEMENU_ROLEID FOREIGN KEY (ROLE_ID) REFERENCES AS_ROLE(ROLE_ID),
	CONSTRAINT FK_ROLEMENU_MENUID FOREIGN KEY (MENU_ID) REFERENCES AS_MENU(MENU_ID)
)
Go 


CREATE TABLE AS_LOCATION(
	LOCATION_ID BIGINT, 
	LOCATION_NAME VARCHAR(40), 
	ADDRESS_LINE1 VARCHAR(100), 
	ADDRESS_LINE2 VARCHAR(100),
	CITY VARCHAR(40) ,
	CONSTRAINT PK_LOCATION PRIMARY KEY (LOCATION_ID)
 )
 Go
 
 CREATE TABLE AS_USER_LOCATION(
	USERLOC_ID BIGINT,
	USER_ID   BIGINT,
	LOCATION_ID BIGINT, 
	LOCATION_NAME VARCHAR(40), 
 	CONSTRAINT PK_USER_LOCATION PRIMARY KEY (USERLOC_ID) , 
 	CONSTRAINT FK_USERLOC_USERID FOREIGN KEY (USER_ID) REFERENCES AS_USER(USER_ID),
    CONSTRAINT FK_USERLOC_LOCATIONID FOREIGN KEY (LOCATION_ID) REFERENCES AS_LOCATION(LOCATION_ID),
 )


CREATE TABLE AS_PRODUCT( 
	PRODUCT_ID BIGINT, 
	PRODUCT_NAME VARCHAR(40), 
	PRODUCT_DESC VARCHAR(100),
	RATE DECIMAL(10,2),
	MFD_BY BIGINT,
 	CONSTRAINT PK_PRODUCT PRIMARY KEY (PRODUCT_ID) , 
 	CONSTRAINT UK_PRODUCT_NAME UNIQUE (PRODUCT_NAME),
 	CONSTRAINT FK_PRODUCT_MFDBY FOREIGN KEY (MFD_BY) REFERENCES AS_USER(USER_ID)
)
Go

CREATE TABLE AS_ORDER(
    ORDER_ID BIGINT,
	PRODUCT_ID BIGINT, 
	QUANTITY INTEGER, 
	ORDERED_BY BIGINT,
	ORDER_DATE DATE,
	DELIVERY_LOCATION BIGINT,
	PROD_PICKUP_DATE DATE,
	WHS_REACH_DATE DATE,
	WHS_PICKUP_DATE DATE,
	DELIVERY_DATE DATE,
	RECEIVED_BY VARCHAR(40),
	ORDER_STATUS VARCHAR(40), 
	CONSTRAINT PK_ORDER PRIMARY KEY (ORDER_ID),
    CONSTRAINT FK_ORDER_ORDERBY  FOREIGN KEY (ORDERED_BY) REFERENCES AS_USER(USER_ID),
    CONSTRAINT FK_ORDER_PRID FOREIGN KEY (PRODUCT_ID) REFERENCES AS_PRODUCT(PRODUCT_ID),
    CONSTRAINT FK_ORDER_DELLOC FOREIGN KEY (DELIVERY_LOCATION) REFERENCES AS_LOCATION(LOCATION_ID)
)
Go


DELETE FROM  AS_ORDER
DELETE FROM  AS_PRODUCT
DELETE FROM  AS_USER_LOCATION
DELETE FROM  AS_LOCATION 
DELETE FROM  AS_ROLE_MENU  
DELETE FROM AS_MENU 
DELETE FROM  AS_USER 
DELETE FROM AS_ROLE   
DELETE FROM AS_SEQUENCES
Go
-- seed data

-- AS_ROLE
INSERT INTO AS_ROLE (ROLE_ID , ROLE_NAME , ROLE_DESC ) VALUES (1,'Admin','ADMIN ROLE' )  
INSERT INTO AS_ROLE (ROLE_ID , ROLE_NAME , ROLE_DESC ) VALUES (2,'Customer','CUSTOMER ROLE' ) 
INSERT INTO AS_ROLE (ROLE_ID , ROLE_NAME , ROLE_DESC ) VALUES (3,'Shipper','SHIPPER ROLE' )
INSERT INTO AS_ROLE (ROLE_ID , ROLE_NAME , ROLE_DESC ) VALUES (4,'Manufacturer','MANUFACTURER ROLE') 
Go

-- AS_USER
INSERT INTO AS_USER (USER_ID , USER_NAME , USER_PASSWORD, ROLE_ID, EMAIL) VALUES (1,'ADMIN','1', 1 , 'admin@aps.com') 
INSERT INTO AS_USER (USER_ID , USER_NAME , USER_PASSWORD, ROLE_ID, EMAIL) VALUES (2,'CUSTOMER','1', 2,'customer@aps.com' ) 
INSERT INTO AS_USER (USER_ID , USER_NAME , USER_PASSWORD, ROLE_ID, EMAIL) VALUES (3,'SHIPPER','1', 3,'shipper@aps.com') 
INSERT INTO AS_USER (USER_ID , USER_NAME , USER_PASSWORD, ROLE_ID, EMAIL) VALUES (4,'MANUFACTURER','1', 4,'manfacturer@aps.com') 
INSERT INTO AS_USER (USER_ID , USER_NAME , USER_PASSWORD, ROLE_ID, EMAIL) VALUES (5,'Srinivas','1', 2 ,'vsrinivas07@gmail.com') 
INSERT INTO AS_USER (USER_ID , USER_NAME , USER_PASSWORD, ROLE_ID, EMAIL) VALUES (6,'Nokia','1', 4,'nokia@aps.com') 
INSERT INTO AS_USER (USER_ID , USER_NAME , USER_PASSWORD, ROLE_ID, EMAIL) VALUES (7,'Samsung','1', 4,'Samsung@aps.com') 

Go


-- AS_MENU
INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (1,'Roles', '/adminController?module=roles&actionName=list')  
INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (2,'Users', '/adminController?module=users&actionName=list')  
INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (3,'Menus', '/adminController?module=menus&actionName=list') 
INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (4,'Products', '/productController?module=products&actionName=list')
INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (5,'Order', '/orderController?module=orders&actionName=list')
/*
INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (6,'Confirm Order', '/orderController?module=orders&actionName=confirm')
INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (7,'Dispatch Order', '/orderController?module=orders&actionName=dispatch')
INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (8,'Warehouse Reach Confirmation', '/orderController?module=orders&actionName=whr')
INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (9,'Delivery Schedule', '/deliveryController?module=orders&actionName=ds')
INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (10,'Delivery Confirmation', '/deliveryController?module=orders&actionName=dc')

INSERT INTO AS_MENU (MENU_ID, MENU_NAME, MENU_URL) VALUES (11,'All Products', '/productController?module=products&actionName=listAll');
*/
Go

--AS_ROLE_MENU

-- ADMIN
INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (1,1,1,'Y','Y','Y','Y')  
INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (2,1,2,'Y','Y','Y','Y')  
INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (3,1,3,'Y','Y','Y','Y') 

-- CUSTOMER
INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (4,2,5,'Y','Y','Y','Y')  
--INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (5,2,6,'Y','Y','Y','Y') 
--INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (6,2,10,'Y','Y','Y','Y')
--INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (7,2,10,'Y','Y','Y','Y')
INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (8,2,4,'Y','Y','Y','Y')  


-- Shipper
INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (9,3,4,'Y','Y','Y','Y')  
INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (10,3,5,'Y','Y','Y','Y')  

--INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (11,3,6,'Y','Y','Y','Y') 
--INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (12,3,8,'Y','Y','Y','Y') 
--INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (13,3,9,'Y','Y','Y','Y') 
--INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (14,3,10,'Y','Y','Y','Y')
 
-- Man 
INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (15,4,4,'Y','Y','Y','Y')  
INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (16,4,5,'Y','Y','Y','Y')  
--INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (17,4,6,'Y','Y','Y','Y') 
--INSERT INTO AS_ROLE_MENU (ROLEMENU_ID,ROLE_ID,MENU_ID,ADD_ALLOWED,MODIFY_ALLOWED,VIEW_ALLOWED,DELETE_ALLOWED) VALUES (18,4,10,'Y','Y','Y','Y')
Go

-- AS_PRODUCT
INSERT INTO AS_PRODUCT (PRODUCT_ID,PRODUCT_NAME,PRODUCT_DESC,RATE,MFD_BY ) VALUES ( 1, 'Nokia Lumia 520','Nokia Lumia 520',9990.45,6)  
INSERT INTO AS_PRODUCT (PRODUCT_ID,PRODUCT_NAME,PRODUCT_DESC,RATE,MFD_BY ) VALUES ( 2, 'Nokia Lumia 620','Nokia Lumia 520',12990.45,6)  
INSERT INTO AS_PRODUCT (PRODUCT_ID,PRODUCT_NAME,PRODUCT_DESC,RATE,MFD_BY ) VALUES ( 3, 'Nokia Lumia 1020','Nokia Lumia 1020',19990.45,6)  
INSERT INTO AS_PRODUCT (PRODUCT_ID,PRODUCT_NAME,PRODUCT_DESC,RATE,MFD_BY ) VALUES ( 4, 'Samsung Galaxy I','Samsung Galaxy I',9990.45,7)  
INSERT INTO AS_PRODUCT (PRODUCT_ID,PRODUCT_NAME,PRODUCT_DESC,RATE,MFD_BY ) VALUES ( 5, 'Samsung Galaxy II','Samsung Galaxy II',9990.45,7)  
INSERT INTO AS_PRODUCT (PRODUCT_ID,PRODUCT_NAME,PRODUCT_DESC,RATE,MFD_BY ) VALUES ( 6, 'Samsung Galaxy III','Samsung Galaxy III',9990.45,7)  
Go
 

-- AS_ORDER_REQUEST
 
 INSERT INTO AS_ORDER (ORDER_ID,ORDERED_BY,PRODUCT_ID,QUANTITY,ORDER_DATE ) VALUES ( 1,5,1,3,GETDATE())
 INSERT INTO AS_ORDER (ORDER_ID,ORDERED_BY,PRODUCT_ID,QUANTITY,ORDER_DATE ) VALUES ( 2,5,2,11,GETDATE())
 INSERT INTO AS_ORDER (ORDER_ID,ORDERED_BY,PRODUCT_ID,QUANTITY,ORDER_DATE ) VALUES ( 3,5,3,25,GETDATE())
 INSERT INTO AS_ORDER (ORDER_ID,ORDERED_BY,PRODUCT_ID,QUANTITY,ORDER_DATE ) VALUES ( 4,5,4,10,GETDATE())
 INSERT INTO AS_ORDER (ORDER_ID,ORDERED_BY,PRODUCT_ID,QUANTITY,ORDER_DATE ) VALUES ( 5,5,5,2,GETDATE())
 INSERT INTO AS_ORDER (ORDER_ID,ORDERED_BY,PRODUCT_ID,QUANTITY,ORDER_DATE ) VALUES ( 6,5,6,3,GETDATE())
Go
 
-- SEQ
INSERT INTO AS_SEQUENCES( SEQ_NAME , NEXT_VAL, INCR_VAL) VALUES ( 'AS_ORDER_SEQ' , 1001 , 1  ) 
INSERT INTO AS_SEQUENCES( SEQ_NAME , NEXT_VAL, INCR_VAL) VALUES ( 'AS_PRODUCT_SEQ' , 1001 , 1 ) 
INSERT INTO AS_SEQUENCES( SEQ_NAME , NEXT_VAL, INCR_VAL) VALUES ( 'AS_USER_LOCATION_SEQ' , 1001 , 1 ) 
INSERT INTO AS_SEQUENCES( SEQ_NAME , NEXT_VAL, INCR_VAL) VALUES ( 'AS_LOCATION_SEQ'  , 1001 , 1 ) 
INSERT INTO AS_SEQUENCES( SEQ_NAME , NEXT_VAL, INCR_VAL) VALUES ( 'AS_ROLE_MENU_SEQ'   , 1001,1 ) 
INSERT INTO AS_SEQUENCES( SEQ_NAME , NEXT_VAL, INCR_VAL) VALUES ( 'AS_MENU_SEQ', 1001,1 ) 
INSERT INTO AS_SEQUENCES( SEQ_NAME , NEXT_VAL, INCR_VAL) VALUES ( 'AS_USER_SEQ', 1001,1 )  
INSERT INTO AS_SEQUENCES( SEQ_NAME , NEXT_VAL, INCR_VAL) VALUES ( 'AS_ROLE_SEQ', 1001 ,1 )     
Go

 